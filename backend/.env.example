# ============================================================================
# VIETNAMESE SPEECH-TO-TEXT + TOXIC DETECTION - ENVIRONMENT CONFIGURATION
# ============================================================================
# Copy this file to .env and customize for your environment
# All settings are optional - defaults will be used if not specified
# ============================================================================

# ============================================================================
# 1. PROJECT & SERVER CONFIGURATION
# ============================================================================

# Project Information
PROJECT_NAME="Vietnamese Speech-to-Text + Toxic Detection API"
VERSION="2.0.0"
DESCRIPTION="Offline-first Vietnamese Speech Analysis with Optimizations"

# Environment: development, staging, production, testing
ENVIRONMENT=development

# Server Settings
HOST=127.0.0.1
PORT=8000
DEBUG=true

# CORS Settings (comma-separated URLs)
BACKEND_CORS_ORIGINS=http://localhost:3000,http://localhost:5173,http://127.0.0.1:5173

# ============================================================================
# 2. MODEL PATHS & DEVICE CONFIGURATION
# ============================================================================

# Model Paths (relative to backend directory)
ASR_MODEL_PATH=../wav2vec2-base-vietnamese-250h
CLASSIFIER_MODEL_PATH=../phobert-vi-comment-4class

# Device Configuration: cpu, cuda, mps (Apple Silicon)
MODEL_DEVICE=cpu
MODEL_CACHE_SIZE=1

# ============================================================================
# 3. AUDIO PROCESSING SETTINGS
# ============================================================================

# Audio Duration Settings (seconds)
AUDIO_CHUNK_DURATION=2.0
MIN_AUDIO_DURATION=0.1
MAX_AUDIO_DURATION=30.0

# Audio Sample Rate (Hz)
TARGET_SAMPLE_RATE=16000

# Allowed MIME types (comma-separated)
ALLOWED_AUDIO_FORMATS=audio/webm,audio/wav,audio/ogg,audio/mp3

# ============================================================================
# 4. PERFORMANCE & OPTIMIZATION (Tasks 2-9)
# ============================================================================

# Async Processing
ENABLE_ASYNC_PROCESSING=true
MAX_CONCURRENT_CONNECTIONS=100
REQUEST_TIMEOUT=30.0

# Batch Processing
ENABLE_BATCH_PROCESSING=true
ASR_BATCH_SIZE=5
ASR_BATCH_TIMEOUT=0.05
CLASSIFIER_BATCH_SIZE=8
CLASSIFIER_BATCH_TIMEOUT=0.03

# ONNX Runtime (experimental)
USE_ONNX_RUNTIME=false
ONNX_OPTIMIZATION_LEVEL=2

# ============================================================================
# 5. VIETNAMESE TEXT PROCESSING (Task 10)
# ============================================================================

# Enable/disable Vietnamese preprocessing
VIETNAMESE_PREPROCESSING_ENABLED=true

# Text normalization options
REMOVE_TONES_FOR_MATCHING=false
CONVERT_NUMBERS_TO_TEXT=false
NORMALIZE_PUNCTUATION=true
APPLY_COMMON_FIXES=true
FIX_SPACING=true
LOWERCASE_TEXT=false

# Confidence adjustment
ENABLE_CONFIDENCE_ADJUSTMENT=true

# ============================================================================
# 6. CLASSIFICATION SETTINGS (Task 11)
# ============================================================================

# Ensemble Classification
ENABLE_ENSEMBLE_CLASSIFICATION=true
ENSEMBLE_MODEL_WEIGHT=0.7
ENSEMBLE_KEYWORD_WEIGHT=0.3

# Classification Thresholds (0.0 - 1.0)
# Lower = more sensitive, Higher = more selective
TOXIC_THRESHOLD=0.55
NEGATIVE_THRESHOLD=0.60
NEUTRAL_THRESHOLD=0.50
POSITIVE_THRESHOLD=0.60

# Sliding Window for Long Texts
ENABLE_SLIDING_WINDOW=true
SLIDING_WINDOW_SIZE=400
SLIDING_WINDOW_OVERLAP=100
LONG_TEXT_THRESHOLD=500

# Keyword Detection
ENABLE_KEYWORD_DETECTION=true
KEYWORD_FUZZY_MATCHING=true
KEYWORD_DETECTION_THRESHOLD=0.3

# ============================================================================
# 7. METRICS & MONITORING (Task 12)
# ============================================================================

# Metrics Collection
ENABLE_METRICS=true
METRICS_WINDOW_SIZE=1000
METRICS_RETENTION_SECONDS=3600

# Performance Tracking
TRACK_COMPONENT_TIMING=true
TRACK_MEMORY_USAGE=true
TRACK_ERROR_RATES=true

# Metrics Export
METRICS_EXPORT_INTERVAL=60

# ============================================================================
# 8. ERROR HANDLING & RESILIENCE (Task 13)
# ============================================================================

# Circuit Breaker Pattern
ENABLE_CIRCUIT_BREAKER=true
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT_SECONDS=60
CIRCUIT_BREAKER_HALF_OPEN_ATTEMPTS=2

# Retry Logic
ENABLE_RETRY=true
MAX_RETRY_ATTEMPTS=3
RETRY_INITIAL_DELAY=1.0
RETRY_MAX_DELAY=60.0
RETRY_EXPONENTIAL_BASE=2.0

# Error Logging
LOG_ERROR_CONTEXT=true
USER_FRIENDLY_ERRORS=true

# ============================================================================
# 9. SECURITY & LIMITS
# ============================================================================

# Rate Limiting
ENABLE_RATE_LIMITING=true
RATE_LIMIT_PER_MINUTE=60

# Resource Limits
MAX_REQUEST_SIZE_MB=10
MAX_MEMORY_PERCENT=80.0

# WebSocket Limits
WEBSOCKET_MESSAGE_SIZE_LIMIT=10485760  # 10MB
WEBSOCKET_PING_INTERVAL=20.0
WEBSOCKET_PING_TIMEOUT=10.0

# ============================================================================
# 10. LOGGING CONFIGURATION
# ============================================================================

# Logging Level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Log Format: json or console
LOG_FORMAT=json

# Log File (leave empty for stdout)
LOG_FILE=

# Log Rotation
LOG_ROTATION=1 day
LOG_RETENTION=30 days

# ============================================================================
# ENVIRONMENT-SPECIFIC PRESETS
# ============================================================================

# DEVELOPMENT ENVIRONMENT (local testing)
# - Enable all debugging features
# - Lower thresholds for testing
# - Enable all metrics
# - Verbose logging

# STAGING ENVIRONMENT (pre-production)
# - Production-like settings
# - Enable metrics
# - Medium logging verbosity

# PRODUCTION ENVIRONMENT (live deployment)
# - Disable debug mode
# - Higher thresholds
# - Essential metrics only
# - Error-level logging
# - Rate limiting enabled

# ============================================================================
# TUNING RECOMMENDATIONS
# ============================================================================

# For Better Accuracy:
# - Lower TOXIC_THRESHOLD (0.45-0.50) for more sensitivity
# - Enable ENABLE_ENSEMBLE_CLASSIFICATION
# - Enable KEYWORD_FUZZY_MATCHING
# - Enable VIETNAMESE_PREPROCESSING_ENABLED

# For Better Performance:
# - Increase batch sizes (ASR_BATCH_SIZE=10, CLASSIFIER_BATCH_SIZE=15)
# - Disable TRACK_COMPONENT_TIMING in production
# - Use MODEL_DEVICE=cuda if GPU available
# - Lower METRICS_WINDOW_SIZE (500)

# For Better Reliability:
# - Enable ENABLE_CIRCUIT_BREAKER
# - Enable ENABLE_RETRY
# - Set CIRCUIT_BREAKER_FAILURE_THRESHOLD=3 for faster recovery
# - Set MAX_RETRY_ATTEMPTS=5 for more resilience

# For Resource-Constrained Environments:
# - Disable ENABLE_BATCH_PROCESSING
# - Set MAX_CONCURRENT_CONNECTIONS=20
# - Set METRICS_WINDOW_SIZE=100
# - Disable TRACK_MEMORY_USAGE

# ============================================================================
# EXAMPLE CONFIGURATIONS
# ============================================================================

# High Accuracy Configuration (Trade performance for accuracy)
# TOXIC_THRESHOLD=0.45
# ENABLE_ENSEMBLE_CLASSIFICATION=true
# ENSEMBLE_MODEL_WEIGHT=0.6
# ENSEMBLE_KEYWORD_WEIGHT=0.4
# ENABLE_SLIDING_WINDOW=true

# High Performance Configuration (Trade accuracy for speed)
# ASR_BATCH_SIZE=15
# CLASSIFIER_BATCH_SIZE=20
# ENABLE_BATCH_PROCESSING=true
# TRACK_COMPONENT_TIMING=false
# METRICS_WINDOW_SIZE=500

# High Reliability Configuration (Maximum resilience)
# ENABLE_CIRCUIT_BREAKER=true
# CIRCUIT_BREAKER_FAILURE_THRESHOLD=3
# MAX_RETRY_ATTEMPTS=5
# ENABLE_RETRY=true
# LOG_ERROR_CONTEXT=true

# Balanced Configuration (Recommended starting point)
# Use the default values in config_enhanced.py
